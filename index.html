<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{Ciao:Yasu521}</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <canvas id="three-canvas"></canvas>
  <div class="blur-overlay"></div>
    <div class="language-menu">
        <button class="language-toggle"></button>
        <div class="language-list">
            <button class="language-option" data-lang="en">English</button>
            <button class="language-option" data-lang="fr">Français</button>
            <button class="language-option" data-lang="ja">日本語</button>
            <button class="language-option" data-lang="zh">中文</button>
        </div>
    </div>
    <div id="buttonContainer"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
    const buttonsConfig = [
            {
                id: "About Me",
                texts: { en: "About Me", ja: "自己紹介", fr: "Qui suis-je", zh: "关于我" },
                links: { en: "https://aicurion.com/aboutme-ja", ja: "https://aicurion.com/aboutme-ja", fr: "https://aicurion.com/aboutme-ja", zh: "https://aicurion.com/aboutme-ja" },
                position: { top: "30%", left: `20%` }
            },
            {
                id: "Project",
                texts: { en: " Projects", ja: "活動", fr: "Projets", zh: "项目" },
                links: { en: "https://aicurion.com/project-ja", ja:"https://aicurion.com/project-ja", fr: "https://aicurion.com/project-ja", zh:"https://aicurion.com/project-ja" },
                position: { top: "40%", left: "20%" }
            },
            {
                id: "News",
                texts: { en: "News", ja: "お知らせ", fr: "Nouvelles", zh: "消息" },
                links: { en: "https://example.com/contact-en", ja: "https://example.com/contact-ja", fr: "https://example.com/contact-fr", zh: "https://example.com/contact-zh" },
                position: { top: "50%", left: "20%" }
            },
            {
                id: "Contact",
                texts: { en: "Contact", ja: "連絡先", fr: "Contact", zh: "联系我们" },
                links: { en: "https://example.com/contact-en", ja: "https://example.com/contact-ja", fr: "https://example.com/contact-fr", zh: "https://example.com/contact-zh" },
                position: { top: "60%", left: "20%" }
            }
        ];
        const buttonContainer = document.getElementById("buttonContainer");
        buttonsConfig.forEach(config => {
            const button = document.createElement("a");
            button.id = config.id;
            button.className = "menu-button";
            button.href = config.links.en;
            button.textContent = config.texts.en;
            button.style.top = config.position.top;
            button.style.left = config.position.left;
            button.style.right = config.position.right;
            button.style.style = config.position.style;
            buttonContainer.appendChild(button);
        });
        const languageButtons = document.querySelectorAll('.language-option');
        languageButtons.forEach(button => {
            button.addEventListener('click', () => {
                const selectedLanguage = button.getAttribute('data-lang');
                buttonsConfig.forEach(config => {
                    const btn = document.getElementById(config.id);
                    btn.textContent = config.texts[selectedLanguage];
                    btn.href = config.links[selectedLanguage];
                });});});
        document.addEventListener('DOMContentLoaded', () => {
        const toggleButton = document.querySelector('.language-toggle');
        const languageOptions = document.querySelectorAll('.language-option');
        languageOptions.forEach(option => {
            option.addEventListener('click', (e) => {
                const selectedLang = e.target.getAttribute('data-lang');

                const langIcons = {
                    en: 'https://dl.dropboxusercontent.com/scl/fi/wwqqmcio1p1tsck22czrq/7592.png?rlkey=2kz87faydbpnjmv1m4fi8fjzi',
                    fr: 'https://dl.dropboxusercontent.com/scl/fi/qjaswgxqp6m07af0doc1j/7596.png?rlkey=pjcv2qioez0r034ea4iyndgl3&st=0t6mwxtk&dl=0',
                    ja: 'https://dl.dropboxusercontent.com/scl/fi/qnaqgpxi7sfdoxraomw6n/7591.png?rlkey=s4v0scvff2chpmjc3gc8hvgos',
                    zh: 'https://dl.dropboxusercontent.com/scl/fi/etl7rqlcpn25xe2ti6hl3/7607.png?rlkey=cp5edcvttjbaorwhz44cnpsps'
                };

                if (langIcons[selectedLang]) {
                    toggleButton.style.backgroundImage = `url(${langIcons[selectedLang]})`;
                    toggleButton.style.backgroundSize = 'cover';
                    toggleButton.style.backgroundPosition = 'center';
                    toggleButton.style.width = '35px';
                    toggleButton.style.height = '35px';
                    toggleButton.style.borderRadius = '50%';
                    toggleButton.textContent = '';
                }});});});
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas') });
    renderer.setSize(window.innerWidth, window.innerHeight);
    const light = new THREE.DirectionalLight(0xffffff, 10);
    light.position.set(0, 0, 10).normalize();
    scene.add(light);

    const dustTextures= [
    "https://dl.dropboxusercontent.com/scl/fi/sva9qrbssn69ay5ykc28o/dust.png?rlkey=8n0kkpdn0puu5ekdxsfdtnhtz"
    ]; 
    const orangeTextures = [
    "https://dl.dropboxusercontent.com/scl/fi/zyivghngvnfc71ikcafps/1.png?rlkey=3c4vsl45wo80qx7exeyzcuq4e",
    "https://dl.dropboxusercontent.com/scl/fi/yqmbt074l4qkg9xbo4iar/7.png?rlkey=fxe6tbwfgzdl4zysflmz7czal",
    "https://dl.dropboxusercontent.com/scl/fi/3n4vleq7xk60oz34ribb5/9.png?rlkey=5o9a13i8xysy681j0k76zv1ut",
    ];
    const fallingTextures2 = [
    "https://dl.dropboxusercontent.com/scl/fi/0wa6yxelpdercgik0u0j6/2.png?rlkey=k7e1754lx18hqd5j521ao4y87",
    "https://dl.dropboxusercontent.com/scl/fi/pcdzb2aqaqmm8ws974x1i/5.png?rlkey=fx3joybf5cr3i83nwogrvzv4o",
    "https://dl.dropboxusercontent.com/scl/fi/jv6ny1dh36v5fffqq08aw/plant_precise_123.png?rlkey=vp9xfp5bqoxhc1gwuk081n6wc",
    ];
    const whiteTextures = [
    "https://dl.dropboxusercontent.com/scl/fi/zfnd4l56tfxkbtj9kdc9e/3.png?rlkey=prfaxcyukhmvmq0hwfe7ft27r",
    "https://dl.dropboxusercontent.com/scl/fi/0poeyuv7ixzkjwc1p480r/4.png?rlkey=2gymu5lpgega57bitk08k1ozv",
    "https://dl.dropboxusercontent.com/scl/fi/dl19zzqdjum88t3ixtpgk/6.png?rlkey=qp9ceajs61pk25ij86vq89pfd",
    ];
    const blueTextures = [
    "https://dl.dropboxusercontent.com/scl/fi/5scqus7wsfmzc7zmzpywl/plant_precise_128.png?rlkey=api5p4joynhvrlc7j5a1iuc7v",
    "https://dl.dropboxusercontent.com/scl/fi/l87xs77jt4da78uxt37ae/plant_precise_220.png?rlkey=68v8uogkr0ft0qtq3xphdzhr0",
    "https://dl.dropboxusercontent.com/scl/fi/inrp4743y26jpo6o2mdkx/plant_precise_373.png?rlkey=gkdpre7lv42eq57quolrqlbes",
    "https://dl.dropboxusercontent.com/scl/fi/ecjhoxexulhxd4amxa2ij/plant_precise_391.png?rlkey=wvg56jmehave4i4lrvt8g27rk",
    ];
    const pinkTextures = [
    "https://dl.dropboxusercontent.com/scl/fi/yizqmfomoc0xuag4y32bm/plant_precise_258.png?rlkey=zhrhsbr2gx9m8idfb189ffqco",
    "https://dl.dropboxusercontent.com/scl/fi/qyi72q9i0sg6mpdrfpyp7/plant_precise_260.png?rlkey=nzyc222lc7b9mf4chvapp08uv",
    "https://dl.dropboxusercontent.com/scl/fi/j53zthropm0dtemo19az4/plant_precise_261.png?rlkey=2m7t71tjvze2k7eo5zmo4tdxc"
    ];
    const groundTextures = [
    "https://dl.dropboxusercontent.com/scl/fi/5pnr4rzo8w9ielzwxc1se/plant_precise_11.png?rlkey=ih3lrxpt5auq30sdy20um5six",
    "https://dl.dropboxusercontent.com/scl/fi/cjh8oqk0i4vg150v653gu/plant_precise_12.png?rlkey=opv8k1mry2nrn6vwt6nzdbns0",
    "https://dl.dropboxusercontent.com/scl/fi/bl84non5etenxjayxp9rz/plant_precise_15.png?rlkey=ppnnmaxm3c5uwt00n8c9qcf8k"
    ];
    const groundTextures2=[
    "https://dl.dropboxusercontent.com/scl/fi/t32pdiftkw0an9uirw9eh/plant_precise_13.png?rlkey=vgnnljjhubr2a92hidkut5x0f",
    "https://dl.dropboxusercontent.com/scl/fi/xl0lmtynbac3c59eqhq7f/plant_precise_14.png?rlkey=t8nnu9d53205gulwzegil9sp3",
    ];
    const groundTextures3=[
    "https://dl.dropboxusercontent.com/scl/fi/irm28o48uzjnqylh9rg8u/plant_precise_18.png?rlkey=v67uox08hp73yawb9uecj3i8e",
    "https://dl.dropboxusercontent.com/scl/fi/bqoqotikbdcgmvaah5bbt/plant_precise_32.png?rlkey=kyc73m4t1sopg5a4ftuywyiku",
    "https://dl.dropboxusercontent.com/scl/fi/bok9d2xbvcxvj3g5zkqfe/plant_precise_33.png?rlkey=0yhl2km0e7szdmukh92mfou8b"

    ];
    const groundTextures4=[
    "https://dl.dropboxusercontent.com/scl/fi/xgsocs6syv0ws8y4ta9aj/plant_precise_28.png?rlkey=joc3t9hs44bamiy74u8918aho",
    "https://dl.dropboxusercontent.com/scl/fi/s0ptb2twg2wy1iwgi9oul/plant_precise_29.png?rlkey=gwk3w1ip3uljxbgrhl0vo67ui"
    ];

    const loader = new THREE.TextureLoader();
    let dustPlants = [];
    let dustPlants2 = [];
    let fallingFlowers = [];
    let growingFlowers = [];
    let growingFlowers2 = [];
    let growingFlowers3 = [];
    let growingFlowers4 = [];
    let sideFlowers = [];
    const cubes = [];

    const cubeData = [
    { position: { x: 3, y: 3, z: -50 }, size: { x: 3, y: 3, z: 3 }, label: '欢迎' },
    { position: { x: 3, y: -3, z: -50 }, size: { x: 3, y: 3, z: 3 }, label: 'Bonjour' },
    { position: { x: -3, y: 3, z: -50 }, size: { x: 3, y: 3, z: 3 }, label:  "こんにちは"},
    { position: { x: -3, y: -3, z: -50 }, size: { x: 3, y: 3, z: 3 }, label: 'Wellcome' },
    { position: { x: 0, y: 0, z: -50 }, size: { x: 0.5, y: 0.5, z: 0.5 }, label: ' "Touch" ' },
    ];
    const flowerGroups = [
    { flowers: growingFlowers, maxScale: 8 },
    { flowers: growingFlowers2, maxScale: 8 },
    { flowers: growingFlowers3, maxScale: 8 },
    { flowers: growingFlowers4, maxScale: 8 },
    { flowers: sideFlowers, maxScale: 7 },
    { flowers: fallingFlowers, maxScale: 9 },
    ];

    const clock = new THREE.Clock();
    let appear = true;
    function createLabeledCube(position, size, labelText) {
        const geometry = new THREE.BoxGeometry(size.x, size.y, size.z);
        const material = new THREE.MeshBasicMaterial({ 
            color: 0x00ff00
        });
        const cube = new THREE.Mesh(geometry, material);
        cube.position.set(position.x, position.y, position.z);
        const canvas = document.createElement('canvas');
        canvas.width = 256;
        canvas.height = 256;
        const context = canvas.getContext('2d');
        context.fillStyle = 'black';
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = 'white';
        context.font = '48px Arial';
        context.textAlign = 'center';
        context.textBaseline = 'middle';
        context.fillText(labelText, canvas.width / 2, canvas.height / 2);
        const texture = new THREE.CanvasTexture(canvas);
        const textMaterial = new THREE.MeshBasicMaterial({ 
            map: texture,
            transparent: true,
            opacity: 1
            });
        const materials = [
            textMaterial,
            textMaterial,
            textMaterial, 
            textMaterial, 
            textMaterial,
            textMaterial  
        ];
        cube.material = materials;
        return cube;
    }
    cubeData.forEach(data => {
        const cube = createLabeledCube(data.position, data.size, data.label);
        scene.add(cube);
        cubes.push(cube);
    });
    const MAX_SCROLL_SPEED = 3;
    const MIN_SCROLL_SPEED = -3;
    let autoSpeed = 0.5;
    let scrollSpeed = 0 ;
    let currentZ = 0;
    let lastMouseY = 0;
    const topflower = 0 ;
    camera.position.x = 0
    camera.position.y = 0
    camera.position.z = 0;
    let cameraZ = 0;
    let lastCameraZ = 0;
    let startX = 0;
    let startY = 0;
    const renderRange = { zMin: -80, zMax: 0 };
    const shiftThreshold = 2;
    const scale = Math.random() * 2;
    const random_1 = Math.random() * 2;
    const cameraPositionDisplay = document.getElementById('camera-position');
    function createtopFlowers(startZ, endZ) {
    for (let x = -5; x <= 75; x += Math.random()*10) {
        for (let z = startZ; z <= endZ; z += 10) 
            { 
            loader.load(
                orangeTextures[Math.floor(Math.random() * orangeTextures.length)],
                (texture) => { 
                    const material = new THREE.SpriteMaterial({ map: texture });
                    const sprite = new THREE.Sprite(material);
                    const posX = - 35 + x;
                    const posY = 5 + 10 * Math.sin((x / 70) * Math.PI) + Math.random() * 5;
                    const posZ = z + Math.random() * 50 + 10;
  
                    sprite.position.set(posX, posY, posZ);
                    const scales = scale + 0.5;
                    sprite.scale.set(scale, scale, 1);
                    const baseRotation = Math.PI - 5.5;
                    const rotationOffset = (Math.random() - 0.5) * Math.PI / 6;
                    sprite.material.rotation = baseRotation + rotationOffset;
                        fallingFlowers.push(sprite);
                        scene.add(sprite);
                });}}}
    function creategroundFlowers(startZ, endZ) {
    for (let x = -40; x < 40; x += 10) {
        for (let z = startZ; z < endZ; z += 20) {
            const texture = loader.load(whiteTextures[Math.floor(Math.random() * whiteTextures.length)]);
            const material = new THREE.SpriteMaterial({ map: texture, transparent: true });
            const sprite = new THREE.Sprite(material);
            sprite.position.set(
                x + Math.random() * 10 - 5,
                Math.random() * 3 - 15,
                z + Math.random() * 10 - 5
            );          
            sprite.scale.set(scale, scale, 1);
            const maxTilt = Math.PI / 6;
            const minTilt = -Math.PI / 6;
            sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt;
            fallingFlowers.push(sprite); 
            scene.add(sprite);         
        }}}
    function createwhiteFlowers_right(startZ, endZ) {
        for (let x = 5; x < 18; x += 5) {
        for (let z = startZ; z < endZ; z += 40) {
            const texture = loader.load(blueTextures[Math.floor(Math.random() * blueTextures.length)]);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            const posX = x + random_1 + 12; 
            const posY = x + Math.random() * 30 - 25; 
            const posZ = z + random_1;    
            sprite.position.set(posX, posY, posZ);
            sprite.scale.set(scale, scale, 1);
            const maxTilt = Math.PI / 4 + (posY + 40) / 50;
            const minTilt = Math.PI / 8 + (posY + 40) / 200;
            sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt;
            sideFlowers.push(sprite);
            scene.add(sprite);
        }}}
    function createpinkFlowers_right(startZ, endZ) {
        for (let x = 20; x < 30 ; x += 5) {
        for (let z = startZ; z < endZ; z += 40) {
            const texture = loader.load(pinkTextures[Math.floor(Math.random() * pinkTextures.length)]);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            const posX = x + Math.random() *1.5 ;
            const posY = x + Math.random() * 30 - 30;
            const posZ = z + random_1 - 8;
            sprite.position.set(posX, posY, posZ);
            sprite.scale.set(scale, scale, 1);
            const maxTilt = Math.PI / 4 + (posY + 40) / 50;
            const minTilt = Math.PI / 8 + (posY + 40) / 200;
            sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt;
            sideFlowers.push(sprite);
            scene.add(sprite);
        }}}
    function createwhiteFlowers_left(startZ, endZ) {
        for (let x = - 15; x < -10 ; x += 3) {
        for (let z = startZ; z < endZ; z += 40) {
            const texture = loader.load(blueTextures[Math.floor(Math.random() * blueTextures.length)]);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            const posX = x + random_1 - 10 ; 
            const posY = - x + Math.random() * 30 - 30;
            const posZ = z + random_1;
            sprite.position.set(posX, posY, posZ);
            sprite.scale.set(scale, scale, 1);
            const maxTilt = - Math.PI / 4 + (posY + 40) / 50;
            const minTilt = - Math.PI / 8 + (posY + 40) / 200; 
            sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt;
            sideFlowers.push(sprite);
            scene.add(sprite);
        }}}
function createpinkFlowers_left(startZ, endZ) {
    for (let x = - 30; x < -20 ; x += 3) {
      for (let z = startZ; z < endZ; z += 40) {
        const texture = loader.load(pinkTextures[Math.floor(Math.random() * pinkTextures.length)]);
        const material = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(material);
        const posX = x + random_1 - 4;
        const posY = - x + Math.random() * 30 - 30;
        const posZ = z + random_1 - 8;
        sprite.position.set(posX, posY, posZ);
        sprite.scale.set(scale, scale, 1);
        const maxTilt = - Math.PI / 4 + (posY + 40) / 150;
        const minTilt = - Math.PI / 8 + (posY + 40) / 200; 
        sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt -10;
        sideFlowers.push(sprite);
        scene.add(sprite);
      }}}
function createtopGround(startZ, endZ) {
    for (let x = -12; x < 80; x += Math.random()*5) { 
      for (let z = startZ; z < endZ; z += Math.random()*5) {
        const texture = loader.load(groundTextures[Math.floor(Math.random() * groundTextures.length)]);
        const material = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(material);
        sprite.position.set(
          x + random_1 - 35,
          10 + 10 * Math.sin((x / 70) * Math.PI) + Math.random() * 5,
          z + random_1
        );
        sprite.scale.set(scale, scale, 1);
        const baseRotation = Math.PI - 5.5;
        const rotationOffset = (Math.random() - 0.5) * Math.PI / 6;
        sprite.material.rotation = baseRotation + rotationOffset;
        growingFlowers.push(sprite);
        scene.add(sprite);
      }}}
function createGround(startZ, endZ) {
  for (let x = -40; x < 40; x += 2) {
    for (let z = startZ; z < endZ; z += 5) {
      const texture = loader.load(groundTextures2[Math.floor(Math.random() * groundTextures2.length)]);
      const material = new THREE.SpriteMaterial({ map: texture });
      const sprite = new THREE.Sprite(material);
      sprite.position.set(
        x + random_1 + 5, 
        Math.random() * 5 - 20, 
        z + random_1
      );
      sprite.scale.set(scale, scale, 1);
      growingFlowers2.push(sprite);
      scene.add(sprite);    
    }}}
function createGround_right(startZ, endZ) {
    for (let x = 4; x < 18; x += 2) { 
      for (let z = startZ; z < endZ; z += 2) { 
        const texture = loader.load(groundTextures3[Math.floor(Math.random() * groundTextures3.length)]);
        const material = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(material);
        const posX = x + random_1 + 20; 
        const posY = x + Math.random() * 30 - 30;
        const posZ = z + random_1;
        sprite.position.set(posX, posY, posZ);
        sprite.scale.set(scale, scale, 1);
        const maxTilt = Math.PI / 4 + (posY + 40) / 100;
        const minTilt = Math.PI / 8 + (posY + 40) / 200;
        sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt; 
        growingFlowers3.push(sprite);
        scene.add(sprite);
      }}}
  function createGround_left(startZ, endZ) {
    for (let x = - 20; x < -5 ; x += 2) {
      for (let z = startZ; z < endZ; z += 2) {
        const texture = loader.load(groundTextures4[Math.floor(Math.random() * groundTextures4.length)]);
        const material = new THREE.SpriteMaterial({ map: texture });
        const sprite = new THREE.Sprite(material);
        const posX = x + random_1 - 20;
        const posY = - x + Math.random() * 30 - 30;
        const posZ = z + random_1;
        sprite.position.set(posX, posY, posZ);
        sprite.scale.set(scale, scale, 1);
        const maxTilt = - Math.PI / 4 + (posY + 40) / 100;
        const minTilt = - Math.PI / 8 + (posY + 40) / 200;
        sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt + 25 ;
        growingFlowers4.push(sprite);
        scene.add(sprite);
      }}}
    function dustFlowers(startZ, endZ) {
        for (let x = -20; x < 20; x += 5) {
            for (let z = startZ; z < endZ; z += 5) { 
                const texture = loader.load(dustTextures[Math.floor(Math.random() * dustTextures.length)]);
                const material = new THREE.SpriteMaterial({ map: texture });
                const sprite = new THREE.Sprite(material);
                const posX = x + random_1 + 5;
                const posY = Math.random() * 50 - 15;
                const posZ = z + Math.random() * 2 + 10;
                sprite.position.set(posX, posY, posZ);
                sprite.scale.set(scale, scale, 1);
                const maxTilt =  Math.PI / 4 + (posY + 40) / 50; 
                const minTilt =  Math.PI / 8 + (posY + 40) / 200;
                sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt;
                if(Math.random()<=0.2)
                    {
                    dustPlants.push(sprite);
                    scene.add(sprite);
                }}}}
    function dustFlowers2(startZ, endZ) {
        for (let x = -20; x < 20; x += 5) {
            for (let z = startZ; z < endZ; z += 5) {
                const texture = loader.load(fallingTextures2[Math.floor(Math.random() * fallingTextures2.length)]);
                const material = new THREE.SpriteMaterial({ map: texture });
                const sprite = new THREE.Sprite(material);
                const posX = x + random_1 + 5 ;
                const posY = Math.random() * 50 + 0;
                const posZ = z + Math.random() * 10 - 10;
                sprite.position.set(posX, posY, posZ);
                sprite.scale.set(scale, scale, 1);
                const maxTilt =  Math.PI / 4 + (posY + 40) / 50; 
                const minTilt =  Math.PI / 8 + (posY + 40) / 200;
                sprite.material.rotation = Math.random() * (maxTilt - minTilt) + minTilt;
                if(Math.random()<=0.1)
                    {
                    dustPlants2.push(sprite);
                    scene.add(sprite);
                }}}}
    function dustupFlowers() {
        dustPlants.forEach(sprite => {
            if (scrollSpeed >= 0)sprite.position.y += scrollSpeed*0.1*Math.random() + 0.01;});
    }
    function dustdownFlowers() {
        dustPlants2.forEach(sprite => {
            if (scrollSpeed >= 0 )
            sprite.position.y -= scrollSpeed*0.1*Math.random() +0.05; 
            });}
    function removeObjectsOutOfRange(objectsList, zMin, zMax) {
        for (let i = objectsList.length - 1; i >= 0; i--) {
            const object = objectsList[i];
            if (object.position.z < zMin || object.position.z > zMax) {
                scene.remove(object);
                objectsList.splice(i, 1);
            }}}
    function removeFlowersOutOfRange(zMin, zMax) {
        const objectLists = [growingFlowers, growingFlowers2,growingFlowers3,growingFlowers4,fallingFlowers, sideFlowers];
        objectLists.forEach(list => removeObjectsOutOfRange(list, zMin, zMax));
    }
    function update() {
        const cameraZ = camera.position.z;
        if (Math.abs(cameraZ - lastCameraZ) > shiftThreshold) {
            const shiftAmount = cameraZ - lastCameraZ;
            renderRange.zMin += shiftAmount;
            renderRange.zMax += shiftAmount;
            removeFlowersOutOfRange(renderRange.zMin - 1, renderRange.zMax + 1);
            if (shiftAmount > 0) {
                createtopGround(renderRange.zMax - shiftAmount, renderRange.zMax);
                createGround(renderRange.zMax - shiftAmount, renderRange.zMax);
                createGround_right(renderRange.zMax - shiftAmount, renderRange.zMax);
                createGround_left(renderRange.zMax - shiftAmount, renderRange.zMax);
                dustFlowers(renderRange.zMax - shiftAmount, renderRange.zMax);
                dustFlowers2(renderRange.zMax - shiftAmount, renderRange.zMax);
            }
            else{
                createtopGround(renderRange.zMin, renderRange.zMin - shiftAmount);
                createGround(renderRange.zMin, renderRange.zMin - shiftAmount);
                createGround_left(renderRange.zMin, renderRange.zMin - shiftAmount);
                createGround_right(renderRange.zMin, renderRange.zMin - shiftAmount);
                dustFlowers(renderRange.zMin, renderRange.zMin - shiftAmount);
                dustFlowers2(renderRange.zMin, renderRange.zMin - shiftAmount);
            }
            lastCameraZ = cameraZ;
        }}
    function growFlowers(flowers, maxScale) {
        flowers.forEach(flower => {
            const growth = Math.random() * 0.05 + 0.6;
            if (flower.scale.x < maxScale) {
                flower.scale.set(
                    flower.scale.x + growth,
                    flower.scale.y + growth
                );}});}
    function growAllFlowers() {
        flowerGroups.forEach(group => {
            growFlowers(group.flowers, group.maxScale);
        });}
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
    window.addEventListener("mousemove", (event) => {
      const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
      const mouseY = - (event.clientY / window.innerHeight) * 2 + 1;
      camera.rotation.y = - mouseX * 0.5;
      camera.rotation.x =  mouseY * 0.2;
      growAllFlowers();});
    window.addEventListener("wheel", (event) => {
        scrollSpeed -= event.deltaY * 0.05;
        scrollSpeed = Math.max(MIN_SCROLL_SPEED, Math.min(MAX_SCROLL_SPEED, scrollSpeed));
        growAllFlowers();});
    window.addEventListener('click', () => growAllFlowers());
    function animate() {
      requestAnimationFrame(animate);
      const totalSpeed = autoSpeed + scrollSpeed;
      currentZ -= totalSpeed * 0.3;
      camera.position.z = currentZ;
      scrollSpeed *= 0.8;
      camera.position.z = currentZ;
      dustupFlowers();
      dustdownFlowers();
      update();
      removeFlowersOutOfRange(renderRange.zMin - 1, renderRange.zMax + 1); 
      if(Math.random()<=0.05){
        createpinkFlowers_right(renderRange.zMin, renderRange.zMax);
        createpinkFlowers_left(renderRange.zMin, renderRange.zMax);
        createwhiteFlowers_right(renderRange.zMin, renderRange.zMax);
        createwhiteFlowers_left(renderRange.zMin, renderRange.zMax);
        creategroundFlowers(renderRange.zMin, renderRange.zMax);
        createtopFlowers(renderRange.zMin, renderRange.zMax);
      }
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>
